<div class="scroll-container" id="games-scroll-container">
    <mat-expansion-panel (opened)="filterOpenState.set(true)" (closed)="filterOpenState.set(false)">
        <mat-expansion-panel-header>
            <mat-panel-title>Filter</mat-panel-title>
            <mat-panel-description>{{filterSummary}}</mat-panel-description>
        </mat-expansion-panel-header>
        @if (yearOptions$ | async; as yearOptions) {
        <mat-form-field>
            <mat-label>Year</mat-label>
            <mat-select [(ngModel)]="selectedYear">
                <mat-option [value]=""></mat-option>
                @for (year of yearOptions| sort: null: 'desc'; track year) {
                <mat-option [value]="year">{{year}}</mat-option>
                }
            </mat-select>
        </mat-form-field>
        }
    </mat-expansion-panel>

    <table mat-table [dataSource]="dataSource" #table="matTable" matSort class="mat-elevation-z8" infiniteScroll
        [infiniteScrollDistance]="1" [infiniteScrollThrottle]="50" [horizontal]="false" [scrollWindow]="false"
        [immediateCheck]="false" infiniteScrollContainer="#content-wrapper" [fromRoot]="true" (scrolled)="refresh()">

        <!-- Date Column -->
        <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by date">
                Date
            </th>
            <td mat-cell *matCellDef="let game; table: table">
                <span class="date-cell">
                    <a [routerLink]="['/game', game.id]">{{gameDate(game)}}</a>
                    <span class="game-time">
                        @if (game.endTime) {
                        {{gameTime(game)}}&nbsp;-&nbsp;{{endTime(game)}}
                        } @else {
                        {{gameTime(game)}}
                        }
                    </span>
                </span>
            </td>
        </ng-container>

        <!-- Away Team -->
        <ng-container matColumnDef="awayTeam">
            <th mat-header-cell *matHeaderCellDef>
                <span class="team-score">Away</span>
            </th>
            <td mat-cell *matCellDef="let game">
                <span class="team-score">
                    <a [routerLink]="['/team', game.away.id]">
                        @if(condenseInformation) {
                        {{game.away.abbreviation}}
                        }
                        @else {
                        {{game.awayTeamName}}
                        }
                    </a>
                    <span class="score">{{game.awayScore}}</span>
                </span>
            </td>
        </ng-container>

        <!-- Home Team -->
        <ng-container matColumnDef="homeTeam">
            <th mat-header-cell *matHeaderCellDef>
                <span class="team-score">Home</span>
            </th>
            <td mat-cell *matCellDef="let game">
                <span class="team-score">
                    <a [routerLink]="['/team', game.home.id]">
                        @if(condenseInformation) {
                        {{game.home.abbreviation}}
                        }
                        @else {
                        {{game.homeTeamName}}
                        }
                    </a>
                    <span class="score">{{game.homeScore}}</span>
                </span>
            </td>
        </ng-container>

        <!-- Location -->
        <ng-container matColumnDef="location">
            <th mat-header-cell *matHeaderCellDef>Location</th>
            <td mat-cell *matCellDef="let game">
                @if (game.location) {
                <a [routerLink]="['/park', game.location.id]">{{game.location.name}}</a>
                } @else {
                -
                }
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
        <tr mat-row *matRowDef="let game; columns: displayedColumns; table: table"></tr>
    </table>
</div>